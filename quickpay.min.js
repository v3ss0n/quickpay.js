"use strict";!function(a,b){function c(a){var c=arguments.length>1&&arguments[1]!==b?arguments[1]:{};return new CustomEvent(a,c)}function d(a,b,c){var d=document.createElement("button");return d.innerHTML=b||"Pay",d.className=c||"",d.addEventListener("click",function(b){return a.open(),b.preventDefault(),!1}),d}function e(a){var b=document.createElement("input");return b.type="hidden",b.name=a,b}function f(a){var b=["showEmail","showPhone","showName","noSubmit"],c=/^data-qp-(.+)/i,d={showName:!0},e=void 0;return a.forEach(function(a){(e=a.name.match(c))&&(d[e[1].replace(/-([a-z0-9])/g,function(a){return a[1].toUpperCase()})]=a.value)}),b.forEach(function(a){d.hasOwnProperty(a)&&(d[a]="true"==d[a]||1==d[a]||"string"==typeof d[a]&&"false"!=d[a]&&"0"!=d[a]&&d[a])}),d}function g(a,c,d){d===b&&(d=!0);var e=void 0;try{e=new XMLHttpRequest}catch(a){for(var f=["MSXML2.XMLHTTP.5.0","MSXML2.XMLHTTP.4.0","MSXML2.XMLHTTP.3.0","MSXML2.XMLHTTP","Microsoft.XMLHTTP"],g=!1,h=0;h<f.length&&!g;h++)try{e=new ActiveXObject(f[h]),g=!0}catch(a){}}return e.open(a,c,d),e.setRequestHeader("Content-Type","application/json"),e.setRequestHeader("Accept","application/json"),e}if(!function(){function b(a,b){b=b||{bubbles:!1,cancelable:!1,detail:void 0};var c=document.createEvent("CustomEvent");return c.initCustomEvent(a,b.bubbles,b.cancelable,b.detail),c}return"function"!=typeof a.CustomEvent&&(b.prototype=a.Event.prototype,void(a.CustomEvent=b))}(),a.Paysbuy=a.Paysbuy||{},!a.Paysbuy.QuickPay){var h=function(){function d(){var a=arguments.length>0&&arguments[0]!==b?arguments[0]:{};return new e(a)}function e(){var a=arguments.length>0&&arguments[0]!==b?arguments[0]:{};f(this,{_params:f({},k,a),_checkoutPageHolder:!1,_checkoutWindow:!1,_eventContainer:a.eventContainer}),this._prepareCheckout()}function f(){var a=Array.prototype.slice.call(arguments),b=a[0],c=void 0,d=void 0;for(c in a)if(c)for(d in a[c])b[d]=a[c][d];return b}function h(a){function b(a,b){var e=a.isPopup=!b.wrapperId;a.wrapper=e?c(b.dimBackground):document.getElementById(b.wrapperId),a.iframe=d(e),a.wrapper.appendChild(a.iframe)}function c(a){var b=void 0,c=void 0;return b=a?g:e,c=i("div",b),c.classList.add(h),document.body.appendChild(c),c}function d(a){return i("iframe",a?k:j)}var e={border:"none",opacity:"0",visibility:"hidden",zIndex:"99999",left:"0",top:"0",position:"fixed",overflowX:"hidden",width:"100%",height:"100%",transition:u+"ms opacity ease, transform "+u+"ms"},g=f({backgroundColor:"rgba(0,0,0,0.75)"},e),h="qp-wrapper",j={width:"100%",height:"100%",border:"none",margin:"0"},k=f({opacity:"0",transform:"scale(0.9)",transition:u+"ms opacity ease, transform "+u+"ms"},j);b(this,a)}function i(a,b){var c=document.createElement(a);return j(c,b)}function j(a,b){var c=["webkitT","MozT","msT","OT"],d=["-webkit-","-moz-","-ms-","-o-"],e=void 0,f=void 0;for(f in b){if(a.style[f]=b[f],"transform"==f)for(e in c)a.style[c[e]+"ransform"]=b[f];if("transition"==f)for(e in d)a.style[d[e]+"transition"]=b[f].replace("transform",d[e]+"transform")}return a}var k={key:"",onTokenReceived:b,image:"",locale:"en-GB",submitLabel:b,title:"",description:"",amount:0,currency:"THB",invoice:"",showEmail:!1,showPhone:!1,showName:!0,noSubmit:!1,payMethods:"card",payUrl:b,eventContainer:b,containerId:b},l="https://paysbuy.github.io",m="/quickpay.js/demo/lib",n="checkout.html",o="qp_close",p="qp_tokenize_start",q="qp_tokenize_end",r="qp_show",s="qp_hide",t="qp_token_received";f(e.prototype,{open:function(a){var b=f({},this._params,a||{});b.cssImport&&(b.css=this._getImportCSS()),this._sendConfigToCheckout(b),this._tokenReceivedHandler=b.onTokenReceived,this._paymentURL=b.payUrl,this._active=!0,this._cfg=b,this._showCheckout()},_getImportCSS:function(){var a=[].slice,b="";return a.call(document.styleSheets).forEach(function(c){"quickpay"==c.title&&a.call(c.cssRules).forEach(function(a){return b+=a.cssText})}),b},_prepareCheckout:function(){this._checkoutWindow||(this._checkoutPageHolder=this._makePageHolder({dimBackground:!0,wrapperId:this._params.containerId}),this._checkoutListener=this._makeCheckoutListener(),this._initCheckoutIframe(this._checkoutPageHolder.iframe,!this._checkoutPageHolder.isPopup))},_makePageHolder:function(a){return new h(a)},_sendConfigToCheckout:function(b){try{b.hasOwnProperty("mockMode")||(b.mockMode=a.Paysbuy.QuickPay.mockMode),this._checkoutWindow.postMessage(JSON.stringify(b),l+m)}catch(a){}},_listenToCheckout:function(){a.removeEventListener("message",this._checkoutListener),a.addEventListener("message",this._checkoutListener,!1)},_makeCheckoutListener:function(){return function(a){return function(b){if(!a._active)return!1;if(!b.origin||b.origin!=l)return!1;var c=void 0;switch(b.data){case o:a._notify(o),c=a._hideCheckout();break;case p:case q:c=a._notify(b.data);break;default:var d=JSON.parse(b.data);a._tokenReceivedHandler&&a._tokenReceivedHandler(d),a._paymentURL?a._doPayment(a._paymentURL,d,a._cfg):c=a._hideCheckout()}return c}}(this)},_showCheckout:function(){this._checkoutPageHolder.popup(),this._listenToCheckout(),this._notify(r)},_hideCheckout:function(){this._checkoutPageHolder.hidePopup(),this._active=!1,this._notify(s)},_notify:function(a){(this._eventContainer||document).dispatchEvent(c(a,{bubbles:!0,cancelable:!1,detail:void 0}))},_initCheckoutIframe:function(a,b){a.src=l+m+"/"+n,a.addEventListener("load",function(a,b){return function(c){a._checkoutWindow=c.target.contentWindow,b&&a.open()}}(this,b))},_doPayment:function(a,b,c){var d=this,e=g("post",a);e.onreadystatechange=function(){4==e.readyState&&e.responseText&&(200==e.status?d._processPaymentResponse(JSON.parse(e.responseText)):d._showPaymentRequestError())},e.onerror=this._showPaymentRequestError,e.send(JSON.stringify(this._buildPayRequestParams(b,c)))},_buildPayRequestParams:function(a,b){return{token:a.object.token.id,amount:b.amount,currency:b.currency,invoice:b.invoice,description:b.description}},_processPaymentResponse:function(a){console.log(a),alert("payment detail received")},_showPaymentRequestError:function(a){alert(a||"There was an error making the payment request"),this._hideCheckout()}});var u=300;return f(h.prototype,{popup:function(){this.isPopup&&(j(this.wrapper,{visibility:"visible",opacity:1}),document.body.style.overflow="hidden",j(this.iframe,{transform:"scale(1)",opacity:1}))},hidePopup:function(){this.isPopup&&(setTimeout(function(a){return function(){a.wrapper.style.visibility="hidden"}}(this),1.2*u),document.body.style.overflow="",j(this.iframe,{transform:"scale(0.9)",opacity:0}),this.wrapper.style.opacity="0")}}),{configure:d,QP_CLOSE:o,QP_HIDE:s,QP_SHOW:r,QP_TOKENIZESTART:p,QP_TOKENIZEEND:q,QP_TOKENRECEIVED:t}}();a.Paysbuy.QuickPay=h,document.querySelectorAll("style[title=quickpay]").forEach(function(a){return a.disabled=!0})}var i=function(){var a=document.getElementsByTagName("script");return a[a.length-1]}();i.getAttribute("data-qp-key")&&!function(){var b=f([].slice.call(i.attributes)),g=i.parentNode,h=void 0;b.eventContainer=g,h=a.Paysbuy.QuickPay.configure(b),g.appendChild(d(h,b.buttonLabel,i.className));var j=b.qpFieldPrefix||"qp-",k=["name","email","phone"],l={token:e(j+"token")};k.forEach(function(a){b["show"+a[0].toUpperCase()+a.substr(1)]&&(l[a]=e(j+a))}),h._params.onTokenReceived=function(b,d,e){return function(f){for(var g in d)d[g].value=f[g],b.appendChild(d[g]);d.token.dispatchEvent(c(a.Paysbuy.QuickPay.QP_TOKENRECEIVED,{bubbles:!0,cancelable:!0,detail:f})),e&&d.token.form.submit()}}(g,l,!(b.noSubmit||b.payUrl))}()}(window);